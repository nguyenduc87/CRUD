<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Order</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body onload="onPageLoading()">
    <div class="container">
        <p class="h3 text-left mt-5 "> Order Detail !! </p>
        <div class="form-group col-12">
          <!-- <hr class="mt-5 mb-5" /> -->
        </div>
        <div class="form-group">
            <label>Order Code(mã đơn hàng):</label>
            <input class="form-control" id="inp-ordercode" placeholder="...">
        </div>
        <div class="form-group">
            <label>Cỡ Combo:</label>
            <input class="form-control" id="inp-combo" placeholder="...">
        </div>
        <div class="form-group">
            <label>Đường kính Pizza:</label>
            <input class="form-control" id="inp-duong-kinh" placeholder="...">
        </div>
        <div class="form-group">
            <label>Sườn nướng (miếng):</label>
            <input class="form-control" id="inp-suon-nuong" placeholder="...">
        </div>
        <div class="form-group">
            <label>Đồ uống:</label>
            <input class="form-control" id="inp-do-uong" placeholder="...">
        </div>
        <div class="form-group">
            <label>Số lượng nước uống:</label>
            <input class="form-control" id="inp-so-luong-nuoc" placeholder="...">
        </div>
        <div class="form-group">
            <label>VoucherID (mã voucher):</label>
            <input class="form-control" id="inp-voucherid" placeholder="...">
        </div>
        <div class="form-group">
            <label>Loại Pizza (pizza type):</label>
            <input class="form-control" id="inp-loai-pizza" placeholder="...">
        </div>
        <div class="form-group">
            <label>Salad (g):</label>
            <input class="form-control" id="inp-salad" placeholder="...">
        </div>
        <div class="form-group">
            <label>Thành tiền:</label>
            <input class="form-control" id="inp-thanh-tien" placeholder="...">
        </div>
        <div class="form-group">
            <label>Giảm giá (discount):</label>
            <input class="form-control" id="inp-discount" placeholder="...">
        </div>
        <div class="form-group">
            <label>Họ và tên:</label>
            <input class="form-control" id="inp-ho-ten" placeholder="...">
        </div>
        <div class="form-group">
            <label>Email:</label>
            <input class="form-control" id="inp-email" placeholder="...">
        </div>
        <div class="form-group">
            <label>Số điện thoại:</label>
            <input class="form-control" id="inp-dien-thoai" placeholder="...">
        </div>
        <div class="form-group">
            <label>Địa chỉ:</label>
            <input class="form-control" id="inp-adress" placeholder="...">
        </div>
        <div class="form-group">
            <label>Lời nhắn:</label>
            <input class="form-control" id="inp-message" placeholder="...">
        </div>
        <div class="form-group">
            <label>Trạng thái đơn hàng:</label>
            <input class="form-control" id="inp-status" placeholder="...">
        </div>
        <div class="form-group">
            <label>Ngày tạo đơn:</label>
            <input class="form-control" id="inp-tao-don" placeholder="...">
        </div>
        <div class="form-group">
            <label>Ngày cập nhật:</label>
            <input class="form-control" id="inp-update" placeholder="...">
        </div>
    </div>
</body>
<script>
    "use strict";
    /*** REGION 1 - Global variables - Vùng khai báo biến, hằng số, tham số TOÀN CỤC */
    const gREQUEST_STATUS_OK = 200;
    const gREQUEST_READY_STATUS_FINISH_AND_OK = 4;
    //base url
    const gBASE_URL = "http://203.171.20.210:8080/devcamp-pizza365/orders";
    /*** REGION 2 - Vùng gán / thực thi sự kiện cho các elements */
    

    /*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */
    function onPageLoading(){
        // Bước 1. thu thập dữ liệu (không có)
        // get data from query string
        var vUrlString = window.location.href; //đường đẫn gọi đến trang
        console.log(vUrlString);
        var vUrl = new URL(vUrlString);// tạo đối tượng Url để truy vấn tham số
        // get parameters
        var vId = vUrl.searchParams.get("id");
        var vOrderCode = vUrl.searchParams.get("ordercode");
        console.log("id: " + vId);
        console.log("OrderCode: " + vOrderCode);
        // Bước 2. Validate
        const vFORM_LIST_VIEW = "index.html";
        if (vOrderCode == null || vOrderCode == ""){
            alert("Không có mã đơn hàng");
            window.location.href = vFORM_LIST_VIEW;
        }
        else if (vId == null || vId == ""){
            alert("Không có id của đơn hàng");
            window.location.href = vFORM_LIST_VIEW;
        }
        // Bước 3. Goi api tạo order
        var vXmlHttpGetOrderById = new XMLHttpRequest();
        callApiGetOrderCode(vXmlHttpGetOrderById,vOrderCode);
        vXmlHttpGetOrderById.onreadystatechange =
            function () {
                if (this.readyState == gREQUEST_READY_STATUS_FINISH_AND_OK && this.status == gREQUEST_STATUS_OK) {
                    // Bước 4. Hiển thị thông tin tạo đơn hàng
                    //console.log(vXmlHttpGetOrderById.responseText);
                    handleOrderDetail(vXmlHttpGetOrderById);
                }
            }
    }

    /*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình*/
    // Hàm gọi api
    function callApiGetOrderCode(paramXmlHttpCreateOrder,paramOrderCode){
        paramXmlHttpCreateOrder.open("GET", gBASE_URL + "/" + paramOrderCode, true);
        paramXmlHttpCreateOrder.send();
    }
    // hàm xử lý hiển thị
    function handleOrderDetail(paramXmlHttpGetOrderById){
        // parse thành object
        var vOrderObj = JSON.parse(paramXmlHttpGetOrderById.responseText);
        console.log(vOrderObj);
        // truy vấn element
        var vOderCode = document.getElementById("inp-ordercode");
        var vCombo = document.getElementById("inp-combo");
        var vDuongKinh = document.getElementById("inp-duong-kinh");
        var vSuonNuong = document.getElementById("inp-suon-nuong");
        var vDrink = document.getElementById("inp-do-uong");
        var vSoLuongNuoc = document.getElementById("inp-so-luong-nuoc");
        var vVoucherID = document.getElementById("inp-voucherid");
        var vPizza = document.getElementById("inp-loai-pizza");
        var vSalad = document.getElementById("inp-salad");
        var vThanhTien = document.getElementById("inp-thanh-tien");
        var VGiamGia = document.getElementById("inp-discount");
        var vFullname = document.getElementById("inp-ho-ten");
        var vEmail = document.getElementById("inp-email");
        var vPhone = document.getElementById("inp-dien-thoai");
        var vAddress = document.getElementById("inp-adress");
        var vMessage = document.getElementById("inp-message");
        var vStatus = document.getElementById("inp-status");
        var vCreateOrder = document.getElementById("inp-tao-don");
        var vUpdate = document.getElementById("inp-update");
        // gán giá trị
        vOderCode.value = vOrderObj.orderCode;
        vCombo.value = vOrderObj.kichCo;
        vDuongKinh.value = vOrderObj.duongKinh;
        vSuonNuong.value = vOrderObj.suon;
        vDrink.value = vOrderObj.idLoaiNuocUong;
        vSoLuongNuoc.value = vOrderObj.soLuongNuoc;
        vVoucherID.value = vOrderObj.idVourcher;
        vPizza.value = vOrderObj.loaiPizza;
        vSalad.value = vOrderObj.salad;
        vThanhTien.value = vOrderObj.thanhTien;
        VGiamGia.value = vOrderObj.giamGia;
        vFullname.value = vOrderObj.hoTen;
        vEmail.value = vOrderObj.email;
        vPhone.value = vOrderObj.soDienThoai;
        vAddress.value = vOrderObj.diaChi;
        vMessage.value = vOrderObj.loiNhan;
        vStatus.value = vOrderObj.trangThai;
        vCreateOrder.value = vOrderObj.ngayTao;
        vUpdate.value = vOrderObj.ngayCapNhat;
    }
  </script>
</html>